# 日本国債データベース構築プロジェクト - 進捗記録

## プロジェクト概要

本プロジェクトは、2023年度の官報に掲載された日本国債発行に関する告示179件を体系的に解析し、BigQueryデータベースに格納することで、国債発行データの包括的な分析基盤を構築することを目的としています。最終的な目標は、抽出したデータを財務省の公式統計（2023年度発行額：193.46兆円）と完全に照合し、データの正確性を検証することです。

---

## Phase 5までの達成事項

### 1. データ処理の完全達成（100%成功率）

Phase 5では、179件全ての告示ファイルの処理に成功しました。これは、段階的アプローチ（50件→50件→50件→29件）を採用し、各段階で結果を検証しながら進めた結果です。処理プロセスは安定しており、エラーや例外は一切発生しませんでした。

この成果は、単にファイルを読み込んだという以上の意味を持ちます。各告示の構造を正確に理解し、必要な情報を漏れなく抽出し、データベーススキーマに適合する形式で保存するという、複雑な処理パイプライン全体が確立されたことを意味します。

### 2. 4つの告示パターンの識別と専用パーサーの開発

告示には以下の4つの異なる形式が存在することを発見し、それぞれに対応する専用パーサーを開発しました。

**NUMBERED_LIST_MULTI_LAW（番号付きリスト形式・複数根拠法令）**：全体の約56%を占める最も一般的な形式です。「１ 名称及び記号」「２ 発行根拠法律」といった番号付きの項目で構成され、一つの告示の中で複数の法令に基づく国債発行を同時に告知します。例えば、特例公債法に基づく特例国債と財政法に基づく建設国債が、同一告示内で別々の競争入札・非競争入札欄に記載されることがあります。

**TABLE_HORIZONTAL（横並び表形式）**：全体の約13%を占めます。項目が横方向に展開される表形式で、「項目6」に総額が記載され、さらに「附属資料」として詳細な内訳表が添付される構造を持ちます。このため、集計時に総額と内訳の両方を計上すると二重計上が発生する可能性があります。

**RETAIL_BOND（個人向け国債）**：全体の約20%を占めます。個人投資家向けの国債で、独特の記載形式を持ちます。「変動10年」「固定5年」「固定3年」といった商品タイプが明示され、一般的な国債とは異なる情報構造になっています。

**TB_SHORT_TERM（短期国債）**：全体の約11%を占めます。主に財務省証券（Treasury Bills）を対象とし、シンプルな構造を持ちます。満期が1年以内の短期資金調達手段として発行されます。

これら4つのパターンを統一的に処理するために、パターン識別機能を持つ統合パーサーフレームワークを構築しました。このフレームワークは、各告示を読み込むと自動的にパターンを判定し、適切な専用パーサーを呼び出します。

### 3. BigQueryへのデータ投入完了

3層アーキテクチャに基づくデータ投入が完了しました。

**Layer 1（raw_announcements）**：告示の生データを保存します。announcement_id、file_path、raw_text、announcement_typeなどのフィールドを持ち、元データの完全性を保持します。

**Layer 2（announcement_items）**：各告示から抽出した構造化データを保存します。bond_name、issue_amount、legal_basis、bidding_method、announcement_date、maturity_dateなど、分析に必要な項目が整理された形で格納されています。

**Layer 3（分析用ビュー）**：Layer 2のデータを集計・分析しやすい形で提供するビューです。根拠法令別の発行額集計などが可能になっています。

データ投入プロセスでは、パーティション設定（announcement_dateによる日付パーティション）を適切に行い、大量データの効率的な管理と検索を実現しました。

### 4. 根拠法令別の発行額集計の仕組み確立

announcement_itemsテーブルに格納されたデータから、根拠法令別の発行額を集計する仕組みを確立しました。by_law JSONフィールドを活用することで、各法令に基づく発行額を正確に集計できます。

しかし、この集計を実行したところ、総額が約382兆円となり、財務省統計の193.46兆円の約2倍になるという重要な問題を発見しました。この乖離は、単なるエラーではなく、より深い構造的な課題を示唆しています。

---

## Phase 5で発見された重要な課題

### 1. 二重計上の可能性

横並び表形式（TABLE_HORIZONTAL）の告示では、「項目6」に総額が記載され、同時に「附属資料」として詳細な内訳表が添付されます。現在の集計方法では、総額と内訳の両方を合算している可能性があり、これが集計額の過大計上につながっていると考えられます。

この問題は、告示の構造的な特性に起因します。財務省は読者の理解を助けるために総額を明示しつつ、詳細な内訳も提供しています。しかし、データベース設計の観点からは、これらをどのように扱うべきか、明確なルールが必要です。

### 2. by_lawフィールドが空の告示の存在

一部の告示では、by_lawフィールドが空（null）になっています。これは、パーサーが根拠法令情報を抽出できなかったことを意味します。告示の記載方法が変則的であったり、法令情報が暗黙的にしか示されていなかったりする可能性があります。

財務省統計との完全な照合を実現するには、これらの告示からも法令情報を抽出する方法を確立する必要があります。

### 3. 国債種別の分類ルールの理解不足

現在のパーサーは、告示から抽出した情報を機械的にデータベースに格納していますが、それを財務省の公式な国債分類（建設国債、特例国債、借換債など）にどのように対応させるべきかのルールが確立されていません。

例えば、特別会計法第47条第1項に基づく「前倒債」は、どの国債種別に分類されるのでしょうか。このような分類ルールは、財務省の内部資料や運用慣行に基づいている可能性があり、告示の記載だけからは判断が難しい場合があります。

### 4. 財務省の集計方法の詳細不明

財務省が公表している193.46兆円という数字は、どのような集計方法で算出されているのでしょうか。会計年度の区切り方、債務の計上タイミング、借換債の扱い方など、細かな集計ルールが存在する可能性があります。

私たちが告示から抽出したデータをそのまま合算した結果と、財務省の公式統計が一致しないのは、これらの集計方法の違いによるものかもしれません。

---

## Phase 6で取り組むべき研究課題

Phase 5までの成果により、技術的な基盤は確立されました。Phase 6では、データの正確性を検証し、財務省統計との完全な照合を実現するための研究課題に取り組みます。

### 課題1: by_lawフィールドが空の告示からの法令情報抽出

**目的**：全ての告示から根拠法令情報を漏れなく抽出する。

**アプローチ**：
- by_lawフィールドがnullの告示を特定し、元の告示テキストを詳細に分析する。
- 法令情報が明示されていない場合でも、告示の文脈や他の情報（国債の名称、発行条件など）から法令を推定できるかを検討する。
- 変則的な記載方法に対応するため、パーサーのロジックを改良する。
- 場合によっては、財務省の公開資料や過去の類似告示を参照し、手動での法令情報補完も検討する。

### 課題2: 国債種別の正確な分類ルールの確立

**目的**：抽出した根拠法令情報を、財務省の公式な国債分類に正確に対応させる。

**アプローチ**：
- 財務省の公開資料（予算書、決算書、国債統計年報など）を調査し、国債種別の定義と分類基準を明確化する。
- 各法令（財政法第4条、特例公債法、特別会計法各条項など）が、どの国債種別に対応するのかのマッピングテーブルを作成する。
- 特に、複数の法令が同一告示内に記載されている場合の処理方法を確立する。
- 「前倒債」「借換債」「財投債」など、特殊な国債の分類ルールを理解する。

### 課題3: 財務省の集計方法の詳細調査

**目的**：財務省が公表している統計数値の算出方法を理解し、私たちの集計方法を整合させる。

**アプローチ**：
- 財務省の統計資料に記載されている注記や説明文を精読し、集計の前提条件を把握する。
- 会計年度の区切り方（発行日基準か、入札日基準か、決済日基準かなど）を確認する。
- 借換債の扱い方（総額発行額に含めるか、純増額のみを計上するかなど）を調査する。
- 横並び表形式の告示における総額と内訳の関係を理解し、正しい集計方法を確立する。
- 必要に応じて、財務省への問い合わせや、専門家へのヒアリングも検討する。

### 課題4: 二重計上問題の解決

**目的**：現在の集計額（約382兆円）と財務省統計（193.46兆円）の乖離を解消する。

**アプローチ**：
- 横並び表形式の告示について、項目6の総額と附属資料の内訳の関係を詳細に分析する。
- 総額のみを計上すべきか、内訳のみを計上すべきか、あるいは両者をどのように組み合わせるべきかを決定する。
- 決定したルールに基づき、集計用のSQLクエリを改良する。
- 改良後の集計結果を財務省統計と比較し、乖離が許容範囲内に収まるか検証する。
- 乖離が残る場合は、その原因を特定し、さらなる調査を行う。

---

## プロジェクトの現状総括

Phase 5までで、私たちは日本国債発行データベースの技術的基盤を完全に構築しました。179件全ての告示を処理し、4つの異なる形式に対応する専用パーサーを開発し、BigQueryへのデータ投入を完了しました。これは、プロジェクトの第一段階としては完璧な成果です。

しかし、財務省統計との照合を試みる過程で、データの正確性を検証するためには、より深い研究が必要であることが明らかになりました。二重計上の問題、by_lawフィールドが空の告示の存在、国債種別の分類ルールの理解不足、財務省の集計方法の詳細不明といった課題は、単なる技術的なバグではありません。これらは、国債発行という複雑な制度の理解を深め、告示という公式文書の意味を正確に解釈することを求める、研究的な課題です。

Phase 6では、これらの研究課題に体系的に取り組みます。財務省の公開資料を詳細に調査し、法令と国債種別のマッピングを確立し、集計方法を整合させることで、最終的には私たちが構築したデータベースが、財務省の公式統計と完全に一致することを目指します。

この過程は、単にデータベースを構築する以上の価値を持ちます。日本の国債発行制度の全体像を理解し、その運用の実態を明らかにすることで、財政政策の分析や将来予測に活用できる、信頼性の高いデータ基盤を提供することができます。

Phase 5の完了は、ゴールではなく、より深い理解への出発点です。私たちは今、確固たる技術的基盤の上に立ち、次の研究段階へと進む準備が整いました。

---

## 次のステップ

1. Phase 6の課題1から順番に取り組みを開始する。
2. 各課題について、調査結果と解決策をドキュメント化する。
3. 定期的に進捗を本ログに記録する。
4. 最終的な照合結果を検証し、プロジェクトを完了させる。

---

**記録日時**: 2025年10月28日  
**プロジェクト状態**: Phase 5完了、Phase 6準備完了  
**次回作業予定**: Phase 6課題1の着手